<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>使用 npm 包 | Meteor 指南 中译本</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="../images/favicon.png" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://guide-zh.ourmeteor.com">
    <meta property="og:title" content="使用 npm 包 | Meteor 指南 中译本">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@meteor">
    <meta name="twitter:title" content="使用 npm 包 | Meteor 指南 中译本">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style/style.css">
  </head>
  <body class="">
    

<div class="sidebar">
  <div class="panel">
    <div class="panel-item logo">
      <a href="http://www.meteor.com/developers" title="Meteor Developers" target=_new >
        <img src="../images/icon-white.svg" alt="Meteor Developers">
        <span>Meteor Developers</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="http://www.meteor.com/tutorials" target=_new >
          <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><g fill="#112B49"><circle cx="80.001" cy="80" r="3"/><path d="M75.73 85.723c.193-.183.316-.437.316-.723 0-.553-.447-1-1-1-.278 0-.528.114-.71.297l-.004-.004-50.9 50.875c-.18.18-.29.43-.29.707-.002.553.445 1 .998 1 .276 0 .526-.112.708-.293l50.883-50.86zM84.235 74.4c-.18.183-.292.433-.292.71 0 .552.446 1 1 1 .275 0 .525-.113.707-.294l50.87-50.89c.204-.184.34-.442.34-.74 0-.552-.448-1-1-1-.276 0-.526.113-.707.294l-.01-.01L84.236 74.4zM136.583 135.184L85.65 84.23c-.182-.18-.432-.293-.708-.293-.552 0-1 .447-1 1 0 .278.114.528.297.71l50.927 50.95c.18.18.43.293.708.293.553 0 1-.447 1-1 0-.276-.11-.525-.292-.706zM111.19 152.602l-.003-.005-.002-.004-27.552-66.507h-.002c-.15-.362-.505-.617-.922-.617-.552 0-1 .446-1 1 0 .135.028.263.077.38v.002l.005.012 27.552 66.504c.15.362.507.617.924.617.553 0 1-.447 1-1 0-.136-.03-.265-.077-.383zM48.873 7.384L76.435 73.93h.002c.15.362.505.617.922.617.552 0 1-.447 1-1 0-.136-.03-.264-.078-.382h.003L50.72 6.616c-.15-.362-.506-.617-.923-.617-.552 0-1 .447-1 1 0 .136.03.265.078.383h-.002zM152.55 48.844h-.002L86.092 76.422c-.36.15-.617.507-.617.924 0 .553.446 1 1 1 .135 0 .265-.028.383-.077L153.32 50.69c.363-.15.618-.507.618-.924 0-.553-.447-1-1-1-.136 0-.265.028-.383.077h-.005zM7.41 111.136h.002l66.492-27.54c.36-.15.616-.507.616-.924 0-.553-.447-1-1-1-.136 0-.264.028-.382.077v-.002l-.004.002c-.002 0-.004 0-.006.002L6.638 109.29c-.36.15-.615.507-.615.924 0 .553.446 1 1 1 .135 0 .264-.028.382-.077h.004zM159 79H87c-.552 0-1 .448-1 1 0 .554.447 1 1 1h72c.553 0 1-.447 1-1s-.447-1-1-1zM23.435 24.85l50.897 50.897.008-.008c.182.18.43.29.707.29.553 0 1-.446 1-1 0-.296-.135-.555-.34-.737L24.85 23.433c-.183-.18-.433-.292-.71-.292-.55 0-.998.448-.998 1 0 .277.11.528.293.71zM6.618 50.657v.002l66.51 27.54c.003 0 .005 0 .007.002l.004.002c.117.048.245.076.38.076.554 0 1-.447 1-1 0-.417-.254-.772-.616-.923v-.002L7.392 48.813H7.39l-.005-.003c-.118-.047-.247-.076-.383-.076-.552 0-1 .447-1 1 0 .417.256.773.618.923zM153.383 109.28l-66.52-27.53-.006-.002c-.118-.048-.248-.076-.384-.076-.552 0-1 .447-1 1 0 .417.256.773.62.923l66.513 27.528c.003 0 .005 0 .007.002l.004.002c.118.048.246.076.382.076.552 0 1-.447 1-1 0-.417-.256-.772-.617-.923zM80 74c.553 0 1-.447 1-1V1c0-.553-.447-1-1-1-.552 0-1 .447-1 1v72c0 .553.447 1 1 1zM80 86c-.552 0-1 .447-1 1v72c0 .553.447 1 1 1s1-.447 1-1V87c0-.553-.447-1-1-1zM77.36 85.47c-.417 0-.772.254-.923.616l-27.564 66.53.002.002c-.05.117-.077.246-.077.382 0 .553.446 1 1 1 .416 0 .772-.255.922-.618h.002L78.28 86.86v-.004l.003-.005c.048-.117.076-.246.076-.382 0-.552-.448-1-1-1zM82.708 74.547c.417 0 .772-.255.923-.618h.003l27.56-66.547h-.004c.048-.12.076-.247.076-.383 0-.553-.447-1-1-1-.416 0-.772.255-.922.618h-.002l-27.56 66.546h.004c-.05.12-.077.247-.077.383-.002.553.445 1 .998 1zM74 80c0-.552-.446-1-1-1H1c-.552 0-1 .447-1 1 0 .553.447 1 1 1h72c.554 0 1-.446 1-1z"/></g></svg>
          <span>教程</span>
        </a>
      </div>
    
      <div class="panel-item active"">
        <a class="" href="http://guide.meteor.com"  >
          <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><path fill="#BDA671" d="M80 1.988c43.01 0 78 34.99 78 78s-34.99 78-78 78-78-34.99-78-78 34.99-78 78-78m0-2c-44.183 0-80 35.817-80 80s35.817 80 80 80 80-35.817 80-80-35.817-80-80-80z"/><path fill="#BDA671" d="M126.454 33.545l-37.93 54.98-54.98 37.93 37.93-54.98 54.98-37.93m0-2c-.395 0-.79.116-1.135.354L70.336 69.826c-.2.138-.373.312-.51.51l-37.93 54.98c-.548.796-.45 1.868.232 2.55.386.388.898.587 1.414.587.395 0 .79-.116 1.135-.354l54.98-37.93c.2-.137.373-.31.51-.51l37.93-54.98c.548-.795.45-1.867-.232-2.55-.387-.386-.9-.585-1.414-.585z"/><circle fill="#BDA671" cx="79.999" cy="79.999" r="2.999"/><path fill="#BDA671" d="M135.477 50.182c-.02-.036-.04-.05-.06-.045-.173-.303-.485-.516-.858-.516-.553 0-1 .448-1 1 0 .21.078.394.188.554l-.02.007C138.358 59.766 141 69.57 141 79.99c0 33.636-27.364 61-61 61-10.42 0-20.232-2.634-28.82-7.26l-.005.02c-.144-.08-.3-.14-.478-.14-.552 0-1 .448-1 1 0 .336.176.618.43.8-.016.012-.034.025-.03.027 8.896 4.81 19.078 7.552 29.904 7.552 34.795 0 63-28.206 63-63 0-10.79-2.735-20.93-7.523-29.805zM109.65 24.47c-.002-.02.004-.04-.025-.056-8.83-4.727-18.908-7.426-29.625-7.426-34.794 0-63 28.206-63 63 0 10.79 2.73 20.935 7.514 29.81.005.01.012.004.018.01.17.312.488.532.87.532.552 0 1-.447 1-1 0-.197-.073-.37-.17-.525l.04-.002C21.642 100.223 19 90.41 19 79.988c0-33.636 27.364-61 61-61 10.4 0 20.185 2.634 28.757 7.248.02.01.036.02.055.028.116.047.24.075.37.075.554 0 1-.448 1-1 .002-.382-.22-.7-.533-.87z"/></svg>
          <span>指南</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://docs.meteor.com"  >
          <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><path fill="#DE4F4F" d="M35.6 30.167v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .553-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .553-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .55-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .55-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .55-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .55-.447 1-1 1H35.6v5.375h89.8c.553 0 1 .447 1 1v7.375c0 .55-.447 1-1 1H35.6v5.375H80c.552 0 1 .447 1 1v10.873c1.162.413 2 1.51 2 2.816 0 1.657-1.343 3-3 3s-3-1.343-3-3c0-1.305.837-2.402 2-2.815v-9.873H34.6c-.552 0-1-.45-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.45-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.45-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.45-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.45-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.447-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.447-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.447-1-1v-7.375c0-.553.448-1 1-1h89.8v-5.375H34.6c-.552 0-1-.447-1-1s.448-1 1-1h90.8c.553 0 1 .447 1 1v7.375c0 .553-.447 1-1 1H35.6zM138 6.564H22c-1.104 0-2 .896-2 2v144c0 1.104.896 2 2 2h48.995c.258 0 .516-.097.712-.293.39-.39.39-1.022 0-1.413-.195-.195-.45-.293-.707-.293H22v-144h116v144H89.006c-.258 0-.517.097-.713.293-.39.39-.39 1.023 0 1.414.196.198.455.294.713.293H138c1.104 0 2-.895 2-2v-144c0-1.103-.896-2-2-2z"/></svg>
          <span>API 文档</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="https://forums.meteor.com/" target=_new >
          <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><path fill="#333" d="M60.025 17.72c7.396 0 14.914 1.424 22.172 4.43 29.594 12.258 43.648 46.188 31.39 75.782-9.25 22.334-30.843 35.812-53.6 35.812-4.694 0-9.437-.574-14.132-1.76L32.44 142.277 30.23 125.51C5.908 111.003-4.74 80.48 6.418 53.538 15.67 31.204 37.266 17.72 60.025 17.72m0-2c-24.363 0-46.13 14.545-55.455 37.053-5.547 13.394-6.06 28.33-1.447 42.052 4.465 13.276 13.414 24.57 25.252 31.896l2.082 15.82c.092.708.557 1.31 1.217 1.585.246.104.506.152.766.152.434 0 .86-.142 1.217-.412l12.656-9.713c4.482 1.055 9.076 1.59 13.674 1.59 24.36 0 46.126-14.543 55.447-37.047 6.135-14.807 6.135-31.115.002-45.922C109.3 37.966 97.77 26.433 82.963 20.3c-7.34-3.04-15.06-4.58-22.938-4.58zM92.69 133.9c.165-.443.614-.683 1.064-.623l.004-.024c5.18.558 10.343.396 15.365-.414v2.034c-5.13.796-10.4.942-15.69.356l.002-.02c-.052-.01-.105-.006-.158-.023-.517-.193-.78-.768-.586-1.287z"/><path fill="#333" d="M100.877 133.604c4.41-.065 8.86-.633 13.268-1.746l13.416 10.295 2.208-16.77c24.324-14.505 34.976-45.03 23.814-71.97-9.248-22.33-30.832-35.81-53.584-35.82v.02c-2.072-.002-4.154.096-6.238.32l-.004-.024c-.45.058-.9-.18-1.064-.625-.194-.518.068-1.093.586-1.286.054-.02.107-.015.158-.026l-.002-.02c2.19-.24 4.377-.348 6.553-.35v-.01c24.36.004 46.12 14.545 55.443 37.054 5.55 13.393 6.062 28.327 1.447 42.05-4.465 13.28-13.414 24.57-25.252 31.897l-2.082 15.818c-.092.71-.557 1.312-1.217 1.586-.246.103-.506.15-.766.15-.435 0-.86-.14-1.218-.412l-12.655-9.713c-4.2.988-8.502 1.502-12.812 1.564l.002-1.986z"/><circle fill="#333" cx="60.019" cy="77" r="3.001"/><circle fill="#333" cx="76.018" cy="77" r="3"/><circle fill="#333" cx="44.019" cy="77" r="3.001"/></svg>

          <span>论坛</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Meteor 指南 中译本</span>
      
        <span class="select version-sidebar nochrome">
          <select class="version-select">
            
              <option value="v1.3">1.3</option>
            
              <option value="v1.2">1.2</option>
            
          </select>
        </span>
      
    </div>

    
    <div class="wrapper-search">
      <div class="input-symbol small round">
        <input type="text" placeholder="Search 官方指南" id="desktop-search-input" />
        <span class="icon-search"></span>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>介绍</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="code-style.html" class="sidebar-link ">
                  <span>编码风格</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="structure.html" class="sidebar-link ">
                  <span>Application Structure</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="1.3-migration.html" class="sidebar-link ">
                  <span>Migrating to Meteor 1.3</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">数据</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="collections.html" class="sidebar-link ">
                  <span>数据集与数据结构</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="data-loading.html" class="sidebar-link ">
                  <span>Publications and Data Loading</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="methods.html" class="sidebar-link ">
                  <span>Methods</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="accounts.html" class="sidebar-link ">
                  <span>Users and Accounts</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="testing.html" class="sidebar-link ">
                  <span>Testing</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">视图</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="routing.html" class="sidebar-link ">
                  <span>URL 和路由</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="ui-ux.html" class="sidebar-link ">
                  <span>User Interfaces</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="blaze.html" class="sidebar-link ">
                  <span>Blaze</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="react.html" class="sidebar-link ">
                  <span>React</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="angular.html" class="sidebar-link ">
                  <span>Angular</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">构建</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="atmosphere-vs-npm.html" class="sidebar-link ">
                  <span>Atmosphere vs. npm</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="using-atmosphere-packages.html" class="sidebar-link ">
                  <span>Using Atmosphere Packages</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="writing-atmosphere-packages.html" class="sidebar-link ">
                  <span>Writing Atmosphere Packages</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>使用 npm 包</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="writing-npm-packages.html" class="sidebar-link ">
                  <span>Writing npm Packages</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="mobile.html" class="sidebar-link ">
                  <span>Mobile</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="build-tool.html" class="sidebar-link ">
                  <span>Build System</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">生产环境</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="security.html" class="sidebar-link ">
                  <span>Security</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="deployment.html" class="sidebar-link ">
                  <span>Deployment and Monitoring</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">有关本指南</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="CONTRIBUTING.html" class="sidebar-link ">
                  <span>Contribution Guidelines</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="CHANGELOG.html" class="sidebar-link ">
                  <span>Changelog</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>


<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item">
      <span class="js-sidebar-toggle">
        <span class="icon-menu"></span>
      </span>
    </div>
  </div>

  <div class="center-wrapper">
    <img src="../images/logo-coralspace.svg" alt="Meteor 指南 中译本"/>
    <div>官方指南</div>
  </div>

  
  <div class="nav-group right">
    <div class="nav-item">
      <span class="js-search-toggle">
        <span class="icon-search"></span>
      </span>
    </div>
  </div>

  <div class="nav-search">
    <div class="input-symbol">
      <input type="text" placeholder="Search 官方指南" id="mobile-search-input"/>
      <span class="icon-search"></span>
    </div>

    <div class="nav-group right">
      <div class="nav-item">
        <span class="js-search-toggle">
          <span class="icon-close"></span>
        </span>
      </div>
    </div>
    
    <div class="wrapper-mobile-search-results"></div>
  </div>
  
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">使用 npm 包</h1>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn primary small round lowercase" href="https://github.com/ourmeteor/guide-zh/tree/master/content/using-npm-packages.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
            <a class="btn tertiary small round lowercase" href="https://forums.meteor.com/t/20193"><span class="icon-comment"></span> <span>Discuss</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <h2 id="npm-searching">查找 npm 包</h2>

<p>在 <a href="https://www.npmjs.com/" target="_blank" rel="external">npmjs.com</a> 查找 npm 包是最好的方法。 当然对于具有明显倾向的特殊种类的包，在其他的网站也有提供，例如站如其名的 <a href="http://react-components.com/" target="_blank" rel="external">react-components.com</a> 就提供了 React 的相关 npm 组件包。</p>
<h2 id="client-npm">在客户端使用 npm 包</h2>

<p>为了在客户端浏览器的环境中调用这些为服务端设计的包，开发者们设计并提供了很多工具来在客户端模拟 Node 环境，包括 <a href="http://browserify.org" target="_blank" rel="external">browserify</a> 和 <a href="https://webpack.github.io" target="_blank" rel="external">webpack</a> 等。Meteor 的 ES2015 模块系统就可以让开发者在没有任何额外配置的情况下，在客户端调用现成的 npm 包。大多数情况下，你都可以像在服务端一样从客户端文件中导入 npm 依赖。</p>
<blockquote>
<p>在创建一个新的应用的时候，Meteor 会安装 <code>meteor-node-stubs</code> 包来解决在客户端的浏览器兼容问题。如果你的应用要升级到Meteor 1.3，那你可能必须手动运行 <code>meteor npm install --save meteor-node-stubs</code> 命令了。</p>
</blockquote>
<h2 id="installing-npm">安装 npm 包</h2>

<p>npm 包配置放在项目根目录的 <code>package.json</code> 文件中。如果你创建了一个新的 Meteor 项目，Meteor 会自动在这里为你生成该文件。旧项目升级的话，运行 <code>meteor npm init</code> 手动新建一个。</p>
<p>你可以通过在项目根目录运行带 <code>--save</code> 选项的 <code>npm install</code> 命令来安装某个 npm 包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor npm install --save moment</span><br></pre></td></tr></table></figure>
<p>这个操作将会在 <code>package.json</code> 文件中添加相关的 npm 依赖并且下载包到本地的 <code>node_modules/</code> 目录中。通常，不用在版本控制系统中检入 <code>node_modules/</code> 文件夹，当相关 npm 包有更新的时候，你的团队成员可以通过运行 <code>meteor npm install</code> 来保持 npm 处于最新状态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor npm install</span><br></pre></td></tr></table></figure>
<p>如果这只是一个开发阶段的依赖包（例如：它是用来测试，代码格式检查等等），那么你就应该是用<code>--save-dev</code>标识。那样的话，如果你用脚本构建，可以通过 <code>npm install --production</code> 命令来避免安装不需要的包。</p>
<p>关于 <code>npm install</code>，请参考<a href="https://docs.npmjs.com/getting-started/installing-npm-packages-locally" target="_blank" rel="external"> Meteor 官方文档</a></p>
<blockquote>
<p>Meteor 自带了一个 npm，所以你可以输入 <code>meteor npm</code> 而不需自己安装一个。当然，如果你愿意，可以使用一个全局安装的 npm 来管理包。<br>译注：过高版本的全局 npm 在现在可能引起一定问题。建议使用 <code>meteor npm</code>。你也许希望使用一个 npm 镜像，但是 Meteor 自带的尚不支持使用镜像。</p>
</blockquote>
<h2 id="using-npm">使用 npm 包</h2>

<p>通过简单地 <code>import</code> 包名可以向应用里面导入 npm 包。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">'moment'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个就等同于标准的 node require 用法：</span></span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>);</span><br></pre></td></tr></table></figure>
<p>以上的脚本展示的是如何从包里面导入一个默认的导出量到 <code>moment</code> 变量。</p>
<p>通过<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" target="_blank" rel="external">解构赋值</a>（ destructuring assignment ）的语法，你也可以导入包中某些函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isArray &#125; <span class="keyword">from</span> <span class="string">'lodash'</span>;</span><br></pre></td></tr></table></figure>
<p>你也可以从包中 import 其他文件或者JS 入口点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; parse &#125; <span class="keyword">from</span> <span class="string">'graphql/language'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="npm-styles">如何从 npm 包导入样式</h3>

<p>利用任何一个 Meteor 支持的 CSS 预处理器，你就可以从 npm 包环境中通过相对和绝对路径导入样式表文件。</p>
<p>使用 <code>{}</code> 语法从 npm 包中通过绝对路径引用，以下是 Less 的示例：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">'&#123;&#125;/node_modules/npm-package-name/button.less'</span>;</span><br></pre></td></tr></table></figure>
<p>从 npm 包中通过相对路径引用</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">'../../node_modules/npm-package-name/colors.less'</span>;</span><br></pre></td></tr></table></figure>
<p>如果你已经安装了 <code>ecmascript</code> 包，你可以直接在 JavaScript 文件中控制加载顺序并导入 CSS 文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'npm-package-name/stylesheets/styles.css'</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当你从 JavaScript 文件中导入 CSS 的时候，这个 CSS 样式是没有和其他通过 Meteor Build tool 处理过的 CSS 放在一起的，而是添加在你的应用下面的 <code>&lt;head&gt;</code> 标记下，<code>&lt;style&gt;...&lt;/style&gt;</code> 里面，紧跟在这里面其他 CSS 后面的。</p>
</blockquote>
<h2 id="npm-shrinkwrap">npm Shrinkwrap</h2>

<p>在 <code>package.json</code> 中，npm 包的版本号通常是一个版本区间，所以，如果这个时候新的版本也刚发布的话，每次调用 <code>npm install</code> 命令的时候有时候可能会安装不一样的版本。为了保证你的团队成员都是使用同一个包的同一版本号，在对 <code>package.json</code> 作出版本更新之后，最好运行一下 <code>npm shrinkwrap</code> 命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装之后</span></span><br><span class="line">meteor npm install --save moment</span><br><span class="line">meteor npm shrinkwrap</span><br></pre></td></tr></table></figure>
<p>这将会生成一个 <code>npm-shrinkwrap.json</code> 文件，里面确定了每个包依赖的特定版本号，如果你想更加精细的控制（特定版本的包也有可能不一样），你需要把这个文件也检入你的版本控制系统里面去。同时为了避免在部署过程中对 npm 服务器的依赖，你应该考虑使用 <a href="#npm-shrinkpack"><code>npm shrinkpack</code></a> 。</p>
<h2 id="async-callbacks">异步回调</h2>

<p>很多 npm 包代码风格是异步的，带回调参数的或者基于 Promise 的。由于一些原因，Meteor 当前是构建在同步框架内的，但使用 <a href="https://github.com/laverdet/node-fibers" target="_blank" rel="external">Fibers</a> 仍然可以编写非阻塞的代码。</p>
<p>Meteor 服务器的全局环境上下文，每一个方法和发布都会初始化一个新的 fiber，如此我们才可以并行处理这么多脚本。很多 Meteor 的 API ，例如：数据集的内部都是依赖在一个 fiber 下的。它们同时也依赖于内部的一套跟踪服务器 「environment」 状态的机制。这意味着，如果你想在 Meteor app 内部运行异步的 Node 代码的话，你需要初始化自己的 fiber 和 environment。让我们来看一个无法运行的例子中的一小段代码。来自于 <a href="https://github.com/mikedeboer/node-github" target="_blank" rel="external">node-github 仓库</a> 的代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Meteor 方法体内部</span></span><br><span class="line">updateGitHubFollowers() &#123;</span><br><span class="line">  github.user.getFollowingFromUser(&#123;</span><br><span class="line">    user: <span class="string">'stubailo'</span></span><br><span class="line">  &#125;, (err, res) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 在这里使用数据集将会抛出异常 </span></span><br><span class="line">    <span class="comment">// 因为异步代码段没有放在在 fiber 环境里面</span></span><br><span class="line">    Followers.insert(res);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来看看几种解决方案。</p>
<h3 id="bind-environment"><code>Meteor.bindEnvironment</code></h3>

<p>大多数情况下，简单的使用 <code>Meteor.bindEnvironment</code> 封装一个回调就可以做到。这个函数同时也会包含在一个 fiber 里面，并且做了需要维护 Meteor 服务端 environment 监测的事情。下面是使用 <code>Meteor.bindEnvironment</code> 的示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Meteor 方法体内部</span></span><br><span class="line">updateGitHubFollowers() &#123;</span><br><span class="line">  github.user.getFollowingFromUser(&#123;</span><br><span class="line">    user: <span class="string">'stubailo'</span></span><br><span class="line">  &#125;, Meteor.bindEnvironment((err, res) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 一切运行正常</span></span><br><span class="line">    Followers.insert(res);</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然而，并不是所有情况的可以运行。如果你想通过它，来调用带返回值 API 方法并提取返回值，那是不可能做到的，因为这段代码是异步运行的。这个时候，你就需要一些别的方法，来把异步的API转换成一个带返回值的同步方法。</p>
<h3 id="wrap-async"><code>Meteor.wrapAsync</code></h3>

<p>许多 npm 包方法都沿袭了能接受 <code>(err, res)</code> 回调参数的惯例。如果你的异步 API 恰好满足以上描述，就如同上面示例，你可以使用 <code>Meteor.wrapAsync</code> 把它转换成 fiberized fiber 化的 API ，它会返回数据和异常，而不是传入回调，方法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置 sync API</span></span><br><span class="line"><span class="keyword">const</span> getFollowingFromUserFiber =</span><br><span class="line">  Meteor.wrapAsync(github.user.getFollowingFromUser, github.user);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Meteor 方法体内部</span></span><br><span class="line">updateGitHubFollowers() &#123;</span><br><span class="line">  <span class="keyword">const</span> res = getFollowingFromUserFiber(&#123;</span><br><span class="line">    user: <span class="string">'stubailo'</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  Followers.insert(res);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回有多少个关注者（followers）</span></span><br><span class="line">  <span class="keyword">return</span> res.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你想重构并且创建一个完全 fiber-wrapper 的 GitHub 客户端，你需要写脚本找出所有的可用的方法并调用 <code>Meteor.wrapAsync</code> 处理它，这样才可以做出一个调用方式类似的更好地兼容 Meteor 的API。</p>
<h3 id="promises">Promises</h3>

<p>最近，许多的 npm 包都抛弃了回调的使用方式，转而采用 Promises 的写法。这意味着你其实可以从一个异步方法中拿到返回值，但它只是一个没有值的空壳，之后也会填入真实的值。</p>
<p>有一个好消息，最新的 ES2015 <code>async/await</code> 语法（ Meteor 1.3 <code>ecmascript</code> 包中包含了这个用法）将会在 Promises 得到应用。如果真这样，那么就可以在客户端和服务端使用统一的，自然的和具有同步化风格的写法。</p>
<p>如果声明一个带 <code>async</code> 关键字的函数（意味着该函数会返回 Promise 本身），然后在其他 Promise 里面，使用 <code>await</code> 关键字来等待。这样序列化的调用其他基于 Promise 的库就会比较简单了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">sendTextMessage</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> toNumber = <span class="keyword">await</span> phoneLookup.findFromEmail(user.emails[<span class="number">0</span>].address);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> client.sendMessage(&#123;</span><br><span class="line">    to: toNumber,</span><br><span class="line">    <span class="keyword">from</span>: <span class="string">'+14506667788'</span>,</span><br><span class="line">    body: <span class="string">'Hello world!'</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="npm-shrinkpack">Shrinkpack</h2>

<p>相对于单独使用 <a href="#npm-shrinkwrap"><code>npm shrinkwrap</code></a> 而言，<a href="https://github.com/JamieMason/shrinkpack" target="_blank" rel="external">Shrinkpack</a> 是一个更加安全的，可重复的打包包依赖的工具。</p>
<p>本质上，它会复制每个 npm 包依赖的内容，生成对应的 tarball 压缩包文件到你应用的源码库里面。它其实就是一个 shrinkwrap 工具，只是生成一个更加健壮的 <code>npm-shrinkwrap.json</code> 版本库文件而已。这样你的应用就可以在不依赖 npm 服务器的情况下进行编译了。这样的好处就是可以在部署的时候产生重复的特定的 build 。</p>
<p>首先你需要全局地安装 shrinkpack 才可以使用它。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g shrinkpack</span><br></pre></td></tr></table></figure>
<p>在把包 shrinkwrap 之后，就可以直接使用了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meteor npm install moment</span><br><span class="line">meteor npm shrinkwrap</span><br><span class="line">shrinkpack</span><br></pre></td></tr></table></figure>
<p>同时你应该检入已生成的 <code>node_shrinkwrap/</code> 到版本控制系统中，确保它不会被你的文本编辑器忽略掉。</p>
<p><strong>备注</strong>: 在项目中使用 npm 包是一个好的想法，它不会影响其他 Atmosphere 包依赖，甚至很多 Atmosphere 包都直接引入 npm 包依赖。</p>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="using-atmosphere-packages.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Using Atmosphere Packages
        </a>
      
      
        <a class="link primary next"
          href="using-packages.html">
          <span class="subtitle-pagination">Next</span>
          
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/ourmeteor/guide-zh/tree/master/content/using-npm-packages.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
    <div class="discourse-comments-wrapper content-wrapper">
      <div id='discourse-comments'></div>
    </div>

    <script type="text/javascript">
      DiscourseEmbed = { discourseUrl: 'http://forums.meteor.com/',
                         topicId: 20193 };

      (function() {
        var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
        d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
      })();
    </script>
  
</div>

    <script src="/script/smooth-scroll.min.js"></script>
    <script src="/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

    <script>
      // nectar ninja
      (function(){
        var handle = '@meteorjs';
        var a = document.createElement('script');
        var m = document.getElementsByTagName('script')[0];
        a.async = 1;
        a.src = 'https://nectar.ninja/api/v1/' + handle.slice(1);
        m.parentNode.insertBefore(a, m);
      })();

     
      
        // Segment Tracking
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
        analytics.load("zQx6cQifkTU79E3L0XAnmrOXP2A5bC6r");
        analytics.page()
        }}();
      

      // search box
      

        ['desktop', 'mobile'].forEach(function(type) {
          var search = docsearch({
            apiKey: 'b123b42bb515f300dc09dc88f7695ec1',
            indexName: 'meteor_guide',
            inputSelector: '#' + type + '-search-input',
            autocompleteOptions: {
              dropdownMenuContainer: '.wrapper-' + type + '-search-results',
              debug: true
            }
          }).autocomplete;

          var sidebar = document.querySelector('.sidebar-content');
          search.on('autocomplete:opened', function() {
            sidebar.classList.add('searching');
          });
          search.on('autocomplete:closed', function() {
            sidebar.classList.remove('searching');
          });
          search.on('autocomplete:updated', function() {
            if (search.val() === '') {
              search.autocomplete.close();
            }
          });
        });
      

      
        var REDIRECTS = {
  "/using-packages.html": "atmosphere-vs-npm.html",
  "/using-packages.html#npm": "using-npm-packages.html",
  "/using-packages.html#client-npm": "using-npm-packages.html#client-npm",
  "/using-packages.html#installing-npm": "using-npm-packages.html#installing-npm",
  "/using-packages.html#using-npm": "using-npm-packages.html#using-npm",
  "/using-packages.html#npm-styles": "using-npm-packages.html#npm-styles",
  "/using-packages.html#npm-shrinkwrap": "using-npm-packages.html#npm-shrinkwrap",
  "/using-packages.html#atmosphere": "using-atmosphere-packages.html",
  "/using-packages.html#atmosphere-searching": "using-atmosphere-packages.html#atmosphere-searching",
  "/using-packages.html#atmosphere-naming": "using-atmosphere-packages.html#atmosphere-naming",
  "/using-packages.html#installing-atmosphere": "using-atmosphere-packages.html#installing-atmosphere",
  "/using-packages.html#using-atmosphere": "using-atmosphere-packages.html#using-atmosphere",
  "/using-packages.html#importing-atmosphere-styles": "using-atmosphere-packages.html#importing-atmosphere-styles",
  "/using-packages.html#peer-npm-dependencies": "using-atmosphere-packages.html#peer-npm-dependencies",
  "/using-packages.html#package-namespacing": "using-atmosphere-packages.html#package-namespacing",
  "/using-packages.html#async-callbacks": "using-npm-packages.html#async-callbacks",
  "/using-packages.html#bind-environment": "using-npm-packages.html#bind-environment",
  "/using-packages.html#wrap-async": "using-npm-packages.html#wrap-async",
  "/using-packages.html#promises": "using-npm-packages.html#promises",
  "/using-packages.html#overriding-packages": "writing-npm-packages.html#overriding-npm-packages",
  "/using-packages.html#npm-overriding": "writing-npm-packages.html#overriding-npm-packages",
  "/using-packages.html#atmosphere-overriding": "writing-atmosphere-packages.html#overriding-atmosphere-packages",
  "/using-packages.html#npm-shrinkpack": "using-npm-packages.html#npm-shrinkpack",
  "/writing-packages.html": "writing-atmosphere-packages.html",
  "/writing-packages.html#npm-vs-atmosphere": "atmosphere-vs-npm.html",
  "/writing-packages.html#creating-npm": "writing-npm-packages.html",
  "/writing-packages.html#including-in-app": "writing-npm-packages.html#including-in-app",
  "/writing-packages.html#publishing-npm": "writing--packages.html#publishing-npm",
  "/writing-packages.html#creating": "writing-atmosphere-packages.html",
  "/writing-packages.html#adding-files": "writing-atmosphere-packages.html#adding-files",
  "/writing-packages.html#adding-javascript": "writing-atmosphere-packages.html#adding-javascript",
  "/writing-packages.html#adding-css": "writing-atmosphere-packages.html#adding-css",
  "/writing-packages.html#adding-style": "writing-atmosphere-packages.html#adding-style",
  "/writing-packages.html#adding-assests": "writing-atmosphere-packages.html#adding-assets",
  "/writing-packages.html#exporting": "writing-atmosphere-packages.html#exporting",
  "/writing-packages.html#dependencies": "writing-atmosphere-packages.html#dependencies",
  "/writing-packages.html#atmosphere-dependencies": "writing-atmosphere--packages.html#atmosphere-dependencies",
  "/writing-packages.html#meteor-version-dependencies": "writing-atmosphere-packages.html#meteor-version-dependencies",
  "/writing-packages.html#version-constraints": "writing-atmosphere-packages.html#version-constraints",
  "/writing-packages.html#npm-dependencies": "writing-atmosphere-packages.html#npm-dependencies",
  "/writing-packages.html#peer-npm-dependencies": "writing-atmosphere-packages.html#peer-npm-dependencies",
  "/writing-packages.html#cordova-plugins": "writing-atmosphere-packages.html#cordova-plugins",
  "/writing-packages.html#testing": "writing-atmosphere-packages.html#testing",
  "/writing-packages.html#testing-with-peer-dependencies": "writing-atmosphere-packages.html#testing-with-peer-dependencies",
  "/writing-packages.html#local-vs-published": "writing-atmosphere-packages.html#local-vs-published",
  "/writing-packages.html#build-plugins": "build-tool.html#build-plugins",
  "/writing-packages.html#types-of-build-plugins": "build-tool.html#types-of-build-plugins",
  "/writing-packages.html#writing-build-plugins": "build-tool.html#writing-build-plugins",
  "/writing-packages.html#caching-build-plugins": "build-tool.html#caching-build-plugins",
  "/testing.html#simple-unit-test": "testing.html#simple-blaze-unit-test"
};

        function redirect() {
          // Support redirects of the form /path#hash
          var locationKey = location.pathname + location.hash;
          if (REDIRECTS[locationKey]) {
            location.replace(location.origin + '/' + REDIRECTS[locationKey]);
          }

          // Support redirects of the form #hash (works for any path)
          var hashKey = location.hash;
          if (REDIRECTS[hashKey]) {
            location.replace(location.origin + '/' + REDIRECTS[hashKey]);
          }
        }

        // Redirect now
        redirect();

        // Redirect on hash change
        window.onhashchange = redirect;
      
    </script>
  </body>
</html>
